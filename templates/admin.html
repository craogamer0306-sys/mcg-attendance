<!doctype html>
<html lang="en">
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{{ app_name }} — Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-light bg-light"><div class="container">
  <a class="navbar-brand" href="#">{{ app_name }} - Admin</a>
  <div>Hi {{ current_user.name }} <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('logout') }}">Logout</a></div>
</div></nav>

<div class="container py-3">
  <h5>Users</h5>
  <table class="table table-sm"><thead><tr><th>Employee ID</th><th>Name</th><th>Role</th><th>Last check-in (today)</th></tr></thead><tbody>
    {% for u in users %}
      {% set att = u.attendances|selectattr('date','equalto',target_date)|list|first %}
      <tr><td>{{ u.employee_id }}</td><td>{{ u.name }}</td><td>{{ u.role }}</td><td>{{ att.check_in.strftime('%H:%M') if att and att.check_in else '-' }}</td></tr>
    {% endfor %}
  </tbody></table>

  <hr>
  <h5>Attendance ({{ target_date }})</h5>
  <a class="btn btn-sm btn-outline-primary" href="{{ url_for('export_attendance') }}">Export CSV</a>
  <table class="table table-sm mt-2"><thead><tr><th>Employee ID</th><th>Name</th><th>Check-in</th><th>Lat</th><th>Lon</th><th>Office</th><th>Status</th></tr></thead><tbody>
    {% for a in attendance %}
      <tr><td>{{ a.user.employee_id }}</td><td>{{ a.user.name }}</td><td>{{ a.check_in.strftime('%H:%M') if a.check_in else '' }}</td><td>{{ a.latitude or '' }}</td><td>{{ a.longitude or '' }}</td><td>{{ a.remarks or '' }}</td><td>{{ a.status or '' }}</td></tr>
    {% endfor %}
  </tbody></table>

  <hr>
  <h5>Recent Tasks</h5>
  <a class="btn btn-sm btn-outline-primary" href="{{ url_for('export_tasks') }}">Export Tasks CSV</a>
  <table class="table table-sm mt-2"><thead><tr><th>Date</th><th>Employee</th><th>Title</th><th>Category</th><th>Status</th></tr></thead><tbody>
    {% for t in tasks %}
      <tr><td>{{ t.date }}</td><td>{{ t.user.name }}</td><td>{{ t.title }}</td><td>{{ t.category }}</td><td>{{ t.status }}</td></tr>
    {% endfor %}
  </tbody></table>

</div>
</body>
</html>
